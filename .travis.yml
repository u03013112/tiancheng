language: shell
os: windows
sudo: required
before_install:
  - rm -r -f /c/Python27
  - powershell -Command "Set-ExecutionPolicy RemoteSigned -scope CurrentUser"
  - powershell -Command "Invoke-Expression (New-Object System.Net.WebClient).DownloadString('https://get.scoop.sh')"
  - scoop help
  - scoop install python
  - python -V
  - scoop install curl
  - scoop install 7zip

env: PATH=/c/Users/travis/scoop/apps/python/current:/c/Users/travis/scoop/apps/python/current/Scripts:/c/Users/travis/scoop/apps/python/current/Tools/Scripts:/c/Users/travis/scoop/shims:/c/Users/travis/scoop:$PATH
install:
  - python -m pip install --upgrade pip
  - pip install --upgrade pip
  - export TZ='Asia/Shanghai'
  - pip install -r requirements.txt
  - pip install pyinstaller
  - curl https://github.com/BtbN/FFmpeg-Builds/releases/download/autobuild-2021-02-12-12-32/ffmpeg-N-101068-gedc45d1bd5-win64-gpl.zip -o ffmpeg.zip
  - ls *
  - 7zip a ffmpeg.zip
  - ls *
script:
  - pyinstaller -F gui.py
  - ls dist
  # - cd dist
  # - git init
  # - git add -A
  # - git commit -m "CJH python exe Auto Builder"
  # #推送至指定仓库，建议使用国内仓库，下载速度快
  # - git push -f "https://${TOKEN_USER}:${TOKEN}@项目地址.git" master:master
deploy:
  provider: releases
  skip_cleanup: true
  file: "$TRAVIS_BUILD_DIR/dist/gui.exe"
  api_key: ${GITHUB_TOKEN}
  # user: ${GITHUBUSERNAME}
  # password: ${GITHUBPASSWORD}
  on:
    tags: true #发布  tag版 时才进行发包